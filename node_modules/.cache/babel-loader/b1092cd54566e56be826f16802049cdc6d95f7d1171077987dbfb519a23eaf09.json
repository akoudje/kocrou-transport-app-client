{"ast":null,"code":"import _objectSpread from\"C:/React/kocrou-transport -Deploy/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";var _process$env$REACT_AP;import axios from\"axios\";import Swal from\"sweetalert2\";/* üåç BASE API URL ‚Äî Gestion dynamique ENV (local + Vercel) */const API_BASE=((_process$env$REACT_AP=process.env.REACT_APP_API_BASE_URL)===null||_process$env$REACT_AP===void 0?void 0:_process$env$REACT_AP.replace(/\\/$/,\"\"))||(window.location.hostname.includes(\"localhost\")?\"http://localhost:5000\":\"https://kocrou-transport-app-server.onrender.com\");console.log(\"üì° API_BASE =\",API_BASE);/* üß© Instance utilisateur */export const userApi=axios.create({baseURL:\"\".concat(API_BASE,\"/api\"),headers:{\"Content-Type\":\"application/json\"},withCredentials:true});userApi.interceptors.request.use(config=>{const token=localStorage.getItem(\"token\");if(token)config.headers.Authorization=\"Bearer \".concat(token);return config;});/* üß© Instance admin */export const adminApi=axios.create({baseURL:\"\".concat(API_BASE,\"/api\"),headers:{\"Content-Type\":\"application/json\"},withCredentials:true});adminApi.interceptors.request.use(config=>{const token=localStorage.getItem(\"adminToken\");if(token)config.headers.Authorization=\"Bearer \".concat(token);return config;});/* ‚ö†Ô∏è Intercepteur de r√©ponse partag√© */const attachResponseInterceptor=(instance,tokenKey,refreshKey,redirectPath)=>{instance.interceptors.response.use(response=>response,async error=>{var _error$response,_error$response2,_error$response2$data;const originalRequest=error.config;const status=(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status;const message=((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||\"Une erreur est survenue lors de la communication avec le serveur.\";if(status===401&&!originalRequest._retry){originalRequest._retry=true;const refreshToken=localStorage.getItem(refreshKey);if(refreshToken){try{const{data}=await axios.post(\"\".concat(API_BASE,\"/api/auth/refresh\"),{refreshToken});const newToken=data.token;localStorage.setItem(tokenKey,newToken);originalRequest.headers[\"Authorization\"]=\"Bearer \".concat(newToken);return instance(originalRequest);}catch(refreshError){handleSessionExpired(tokenKey,refreshKey,redirectPath);return Promise.reject(refreshError);}}else{handleSessionExpired(tokenKey,refreshKey,redirectPath);}}if(!error.response){Swal.fire({icon:\"error\",title:\"Serveur injoignable\",text:\"Impossible de contacter le serveur. V√©rifiez votre connexion Internet.\",confirmButtonColor:\"#2563eb\"});return Promise.reject(error);}const alertOptions={confirmButtonColor:\"#2563eb\",text:message};switch(status){case 400:Swal.fire(_objectSpread({icon:\"warning\",title:\"Requ√™te invalide\"},alertOptions));break;case 403:Swal.fire(_objectSpread({icon:\"error\",title:\"Acc√®s refus√©\",text:\"Vous n'avez pas les droits n√©cessaires pour acc√©der √† cette ressource.\"},alertOptions));break;case 404:Swal.fire(_objectSpread({icon:\"info\",title:\"Non trouv√©\"},alertOptions));break;case 500:default:Swal.fire(_objectSpread({icon:\"error\",title:\"Erreur serveur\",text:\"Le serveur a rencontr√© un probl√®me. R√©essayez plus tard.\"},alertOptions));break;}return Promise.reject(error);});};function handleSessionExpired(tokenKey,refreshKey,redirectPath){Swal.fire({icon:\"warning\",title:\"Session expir√©e\",text:\"Votre session a expir√©. Veuillez vous reconnecter.\",confirmButtonColor:\"#2563eb\"}).then(()=>{localStorage.removeItem(tokenKey);localStorage.removeItem(refreshKey);window.location.href=redirectPath;});}// üîÅ Appliquer les intercepteurs\nattachResponseInterceptor(userApi,\"token\",\"refreshToken\",\"/login\");attachResponseInterceptor(adminApi,\"adminToken\",\"adminRefreshToken\",\"/admin-login\");","map":{"version":3,"names":["axios","Swal","API_BASE","_process$env$REACT_AP","process","env","REACT_APP_API_BASE_URL","replace","window","location","hostname","includes","console","log","userApi","create","baseURL","concat","headers","withCredentials","interceptors","request","use","config","token","localStorage","getItem","Authorization","adminApi","attachResponseInterceptor","instance","tokenKey","refreshKey","redirectPath","response","error","_error$response","_error$response2","_error$response2$data","originalRequest","status","message","data","_retry","refreshToken","post","newToken","setItem","refreshError","handleSessionExpired","Promise","reject","fire","icon","title","text","confirmButtonColor","alertOptions","_objectSpread","then","removeItem","href"],"sources":["C:/React/kocrou-transport -Deploy/client/src/utils/api.js"],"sourcesContent":["import axios from \"axios\";\r\nimport Swal from \"sweetalert2\";\r\n\r\n/* üåç BASE API URL ‚Äî Gestion dynamique ENV (local + Vercel) */\r\nconst API_BASE =\r\n  process.env.REACT_APP_API_BASE_URL?.replace(/\\/$/, \"\") ||\r\n  (window.location.hostname.includes(\"localhost\")\r\n    ? \"http://localhost:5000\"\r\n    : \"https://kocrou-transport-app-server.onrender.com\");\r\n\r\nconsole.log(\"üì° API_BASE =\", API_BASE);\r\n\r\n/* üß© Instance utilisateur */\r\nexport const userApi = axios.create({\r\n  baseURL: `${API_BASE}/api`,\r\n  headers: { \"Content-Type\": \"application/json\" },\r\n  withCredentials: true,\r\n});\r\n\r\nuserApi.interceptors.request.use((config) => {\r\n  const token = localStorage.getItem(\"token\");\r\n  if (token) config.headers.Authorization = `Bearer ${token}`;\r\n  return config;\r\n});\r\n\r\n/* üß© Instance admin */\r\nexport const adminApi = axios.create({\r\n  baseURL: `${API_BASE}/api`,\r\n  headers: { \"Content-Type\": \"application/json\" },\r\n  withCredentials: true,\r\n});\r\n\r\nadminApi.interceptors.request.use((config) => {\r\n  const token = localStorage.getItem(\"adminToken\");\r\n  if (token) config.headers.Authorization = `Bearer ${token}`;\r\n  return config;\r\n});\r\n\r\n/* ‚ö†Ô∏è Intercepteur de r√©ponse partag√© */\r\nconst attachResponseInterceptor = (instance, tokenKey, refreshKey, redirectPath) => {\r\n  instance.interceptors.response.use(\r\n    (response) => response,\r\n    async (error) => {\r\n      const originalRequest = error.config;\r\n      const status = error.response?.status;\r\n      const message =\r\n        error.response?.data?.message ||\r\n        \"Une erreur est survenue lors de la communication avec le serveur.\";\r\n\r\n      if (status === 401 && !originalRequest._retry) {\r\n        originalRequest._retry = true;\r\n        const refreshToken = localStorage.getItem(refreshKey);\r\n        if (refreshToken) {\r\n          try {\r\n            const { data } = await axios.post(`${API_BASE}/api/auth/refresh`, {\r\n              refreshToken,\r\n            });\r\n            const newToken = data.token;\r\n            localStorage.setItem(tokenKey, newToken);\r\n            originalRequest.headers[\"Authorization\"] = `Bearer ${newToken}`;\r\n            return instance(originalRequest);\r\n          } catch (refreshError) {\r\n            handleSessionExpired(tokenKey, refreshKey, redirectPath);\r\n            return Promise.reject(refreshError);\r\n          }\r\n        } else {\r\n          handleSessionExpired(tokenKey, refreshKey, redirectPath);\r\n        }\r\n      }\r\n\r\n      if (!error.response) {\r\n        Swal.fire({\r\n          icon: \"error\",\r\n          title: \"Serveur injoignable\",\r\n          text: \"Impossible de contacter le serveur. V√©rifiez votre connexion Internet.\",\r\n          confirmButtonColor: \"#2563eb\",\r\n        });\r\n        return Promise.reject(error);\r\n      }\r\n\r\n      const alertOptions = {\r\n        confirmButtonColor: \"#2563eb\",\r\n        text: message,\r\n      };\r\n\r\n      switch (status) {\r\n        case 400:\r\n          Swal.fire({ icon: \"warning\", title: \"Requ√™te invalide\", ...alertOptions });\r\n          break;\r\n        case 403:\r\n          Swal.fire({\r\n            icon: \"error\",\r\n            title: \"Acc√®s refus√©\",\r\n            text: \"Vous n'avez pas les droits n√©cessaires pour acc√©der √† cette ressource.\",\r\n            ...alertOptions,\r\n          });\r\n          break;\r\n        case 404:\r\n          Swal.fire({ icon: \"info\", title: \"Non trouv√©\", ...alertOptions });\r\n          break;\r\n        case 500:\r\n        default:\r\n          Swal.fire({\r\n            icon: \"error\",\r\n            title: \"Erreur serveur\",\r\n            text: \"Le serveur a rencontr√© un probl√®me. R√©essayez plus tard.\",\r\n            ...alertOptions,\r\n          });\r\n          break;\r\n      }\r\n\r\n      return Promise.reject(error);\r\n    }\r\n  );\r\n};\r\n\r\nfunction handleSessionExpired(tokenKey, refreshKey, redirectPath) {\r\n  Swal.fire({\r\n    icon: \"warning\",\r\n    title: \"Session expir√©e\",\r\n    text: \"Votre session a expir√©. Veuillez vous reconnecter.\",\r\n    confirmButtonColor: \"#2563eb\",\r\n  }).then(() => {\r\n    localStorage.removeItem(tokenKey);\r\n    localStorage.removeItem(refreshKey);\r\n    window.location.href = redirectPath;\r\n  });\r\n}\r\n\r\n// üîÅ Appliquer les intercepteurs\r\nattachResponseInterceptor(userApi, \"token\", \"refreshToken\", \"/login\");\r\nattachResponseInterceptor(adminApi, \"adminToken\", \"adminRefreshToken\", \"/admin-login\");\r\n\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}