{"ast":null,"code":"// client/src/context/SettingsContext.js\nimport React,{createContext,useEffect,useState}from\"react\";import smartApi from\"../utils/smartApi\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const SettingsContext=/*#__PURE__*/createContext();export const SettingsProvider=_ref=>{let{children}=_ref;const[settings,setSettings]=useState(null);const[loading,setLoading]=useState(false);const[showBanner,setShowBanner]=useState(false);// üé® Nouvelle banni√®re\n// ===============================\n// 1Ô∏è‚É£ Chargement initial\n// ===============================\nconst fetchSettings=async function(){let silent=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;try{setLoading(true);const{data}=await smartApi.get(\"/settings\");const settingsData=(data===null||data===void 0?void 0:data.data)||data;if(!settingsData)throw new Error(\"Aucun param√®tre syst√®me trouv√©.\");// Comparer avec les pr√©c√©dents\nconst previousColor=settings===null||settings===void 0?void 0:settings.couleurPrincipale;const previousLogo=settings===null||settings===void 0?void 0:settings.logo;setSettings(settingsData);applyTheme(settingsData);// üé® Affiche la banni√®re uniquement si changement visuel\nif(!silent&&(previousColor!==settingsData.couleurPrincipale||previousLogo!==settingsData.logo)){triggerBanner();}console.log(\"‚úÖ Param√®tres syst√®me charg√©s :\",settingsData);}catch(err){console.error(\"‚ùå Erreur lors du chargement des param√®tres :\",err);}finally{setLoading(false);}};// ===============================\n// 2Ô∏è‚É£ Application dynamique du th√®me\n// ===============================\nconst applyTheme=data=>{if(!data)return;const root=document.documentElement;if(data.couleurPrincipale){root.style.setProperty(\"--color-primary\",data.couleurPrincipale);root.style.setProperty(\"--color-primary-hover\",darkenColor(data.couleurPrincipale,0.15));}if(data.logo){localStorage.setItem(\"app_logo\",data.logo);}};// ===============================\n// 3Ô∏è‚É£ Assombrir une couleur\n// ===============================\nconst darkenColor=function(hex){let amount=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0.2;try{const num=parseInt(hex.replace(\"#\",\"\"),16);const r=Math.max(0,(num>>16&255)*(1-amount));const g=Math.max(0,(num>>8&255)*(1-amount));const b=Math.max(0,(num&255)*(1-amount));return\"rgb(\".concat(r,\", \").concat(g,\", \").concat(b,\")\");}catch(_unused){return hex;}};// ===============================\n// 4Ô∏è‚É£ Rafra√Æchissement\n// ===============================\nuseEffect(()=>{console.log(\"‚úÖ SettingsProvider mont√©\");fetchSettings(true);},[]);useEffect(()=>{const interval=setInterval(()=>fetchSettings(true),60000);return()=>clearInterval(interval);},[]);// ===============================\n// 5Ô∏è‚É£ Banni√®re visuelle\n// ===============================\nconst triggerBanner=()=>{setShowBanner(true);setTimeout(()=>setShowBanner(false),2500);};// ===============================\n// 6Ô∏è‚É£ Rendu du provider\n// ===============================\nreturn/*#__PURE__*/_jsxs(SettingsContext.Provider,{value:{settings,loading,fetchSettings,setSettings},children:[children,showBanner&&/*#__PURE__*/_jsx(\"div\",{className:\"fixed top-5 right-5 z-50 bg-green-600 text-white px-5 py-2 rounded-lg shadow-lg animate-fade-in-down\",children:\"\\uD83C\\uDFA8 Th\\xE8me mis \\xE0 jour !\"})]});};","map":{"version":3,"names":["React","createContext","useEffect","useState","smartApi","jsx","_jsx","jsxs","_jsxs","SettingsContext","SettingsProvider","_ref","children","settings","setSettings","loading","setLoading","showBanner","setShowBanner","fetchSettings","silent","arguments","length","undefined","data","get","settingsData","Error","previousColor","couleurPrincipale","previousLogo","logo","applyTheme","triggerBanner","console","log","err","error","root","document","documentElement","style","setProperty","darkenColor","localStorage","setItem","hex","amount","num","parseInt","replace","r","Math","max","g","b","concat","_unused","interval","setInterval","clearInterval","setTimeout","Provider","value","className"],"sources":["C:/React/kocrou-transport -Deploy/client/src/context/SettingsContext.js"],"sourcesContent":["// client/src/context/SettingsContext.js\r\nimport React, { createContext, useEffect, useState } from \"react\";\r\nimport smartApi from \"../utils/smartApi\";\r\n\r\nexport const SettingsContext = createContext();\r\n\r\nexport const SettingsProvider = ({ children }) => {\r\n  const [settings, setSettings] = useState(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [showBanner, setShowBanner] = useState(false); // üé® Nouvelle banni√®re\r\n\r\n  // ===============================\r\n  // 1Ô∏è‚É£ Chargement initial\r\n  // ===============================\r\n  const fetchSettings = async (silent = false) => {\r\n    try {\r\n      setLoading(true);\r\n      const { data } = await smartApi.get(\"/settings\");\r\n      const settingsData = data?.data || data;\r\n\r\n      if (!settingsData) throw new Error(\"Aucun param√®tre syst√®me trouv√©.\");\r\n\r\n      // Comparer avec les pr√©c√©dents\r\n      const previousColor = settings?.couleurPrincipale;\r\n      const previousLogo = settings?.logo;\r\n\r\n      setSettings(settingsData);\r\n      applyTheme(settingsData);\r\n\r\n      // üé® Affiche la banni√®re uniquement si changement visuel\r\n      if (!silent && (previousColor !== settingsData.couleurPrincipale || previousLogo !== settingsData.logo)) {\r\n        triggerBanner();\r\n      }\r\n\r\n      console.log(\"‚úÖ Param√®tres syst√®me charg√©s :\", settingsData);\r\n    } catch (err) {\r\n      console.error(\"‚ùå Erreur lors du chargement des param√®tres :\", err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // ===============================\r\n  // 2Ô∏è‚É£ Application dynamique du th√®me\r\n  // ===============================\r\n  const applyTheme = (data) => {\r\n    if (!data) return;\r\n    const root = document.documentElement;\r\n\r\n    if (data.couleurPrincipale) {\r\n      root.style.setProperty(\"--color-primary\", data.couleurPrincipale);\r\n      root.style.setProperty(\"--color-primary-hover\", darkenColor(data.couleurPrincipale, 0.15));\r\n    }\r\n\r\n    if (data.logo) {\r\n      localStorage.setItem(\"app_logo\", data.logo);\r\n    }\r\n  };\r\n\r\n  // ===============================\r\n  // 3Ô∏è‚É£ Assombrir une couleur\r\n  // ===============================\r\n  const darkenColor = (hex, amount = 0.2) => {\r\n    try {\r\n      const num = parseInt(hex.replace(\"#\", \"\"), 16);\r\n      const r = Math.max(0, ((num >> 16) & 255) * (1 - amount));\r\n      const g = Math.max(0, ((num >> 8) & 255) * (1 - amount));\r\n      const b = Math.max(0, (num & 255) * (1 - amount));\r\n      return `rgb(${r}, ${g}, ${b})`;\r\n    } catch {\r\n      return hex;\r\n    }\r\n  };\r\n\r\n  // ===============================\r\n  // 4Ô∏è‚É£ Rafra√Æchissement\r\n  // ===============================\r\n  useEffect(() => {\r\n    console.log(\"‚úÖ SettingsProvider mont√©\");\r\n    fetchSettings(true);\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    const interval = setInterval(() => fetchSettings(true), 60000);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  // ===============================\r\n  // 5Ô∏è‚É£ Banni√®re visuelle\r\n  // ===============================\r\n  const triggerBanner = () => {\r\n    setShowBanner(true);\r\n    setTimeout(() => setShowBanner(false), 2500);\r\n  };\r\n\r\n  // ===============================\r\n  // 6Ô∏è‚É£ Rendu du provider\r\n  // ===============================\r\n  return (\r\n    <SettingsContext.Provider value={{ settings, loading, fetchSettings, setSettings }}>\r\n      {children}\r\n\r\n      {/* üé® Banni√®re flottante */}\r\n      {showBanner && (\r\n        <div className=\"fixed top-5 right-5 z-50 bg-green-600 text-white px-5 py-2 rounded-lg shadow-lg animate-fade-in-down\">\r\n          üé® Th√®me mis √† jour !\r\n        </div>\r\n      )}\r\n    </SettingsContext.Provider>\r\n  );\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}