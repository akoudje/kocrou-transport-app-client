{"ast":null,"code":"import _objectSpread from\"C:/React/kocrou-transport -Deploy/client/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";var _process$env$REACT_AP;import axios from\"axios\";import Swal from\"sweetalert2\";/* =========================================================\r\n   ðŸŒ BASE API URL â€” Gestion dynamique ENV (local + Vercel)\r\n   ========================================================= */const API_BASE=((_process$env$REACT_AP=process.env.REACT_APP_API_BASE_URL)===null||_process$env$REACT_AP===void 0?void 0:_process$env$REACT_AP.replace(/\\/$/,\"\"))||(window.location.hostname.includes(\"localhost\")?\"http://localhost:5000\":\"https://kocrou-transport-app-server.onrender.com\");console.log(\"ðŸ“¡ API_BASE =\",API_BASE);/* =========================================================\r\n   ðŸ§© INSTANCE AXIOS CENTRALISÃ‰E\r\n   ========================================================= */const api=axios.create({baseURL:\"\".concat(API_BASE,\"/api\"),headers:{\"Content-Type\":\"application/json\"},withCredentials:true// âœ… autorise cookies CORS si nÃ©cessaires\n});/* =========================================================\r\n   ðŸ”’ INTERCEPTEUR DE REQUÃŠTES â€” Ajout Token\r\n   ========================================================= */api.interceptors.request.use(config=>{const token=localStorage.getItem(\"token\");if(token)config.headers.Authorization=\"Bearer \".concat(token);return config;},error=>Promise.reject(error));/* =========================================================\r\n   âš ï¸ INTERCEPTEUR DE RÃ‰PONSES â€” Gestion Erreurs / Refresh\r\n   ========================================================= */api.interceptors.response.use(response=>response,async error=>{var _error$response,_error$response2,_error$response2$data;const originalRequest=error.config;const status=(_error$response=error.response)===null||_error$response===void 0?void 0:_error$response.status;const message=((_error$response2=error.response)===null||_error$response2===void 0?void 0:(_error$response2$data=_error$response2.data)===null||_error$response2$data===void 0?void 0:_error$response2$data.message)||\"Une erreur est survenue lors de la communication avec le serveur.\";// ðŸ” Tentative de refresh token\nif(status===401&&!originalRequest._retry){originalRequest._retry=true;const refreshToken=localStorage.getItem(\"refreshToken\");if(refreshToken){try{const{data}=await axios.post(\"\".concat(API_BASE,\"/api/auth/refresh\"),{refreshToken});const newToken=data.token;localStorage.setItem(\"token\",newToken);originalRequest.headers[\"Authorization\"]=\"Bearer \".concat(newToken);return api(originalRequest);}catch(refreshError){console.warn(\"âš ï¸ Refresh token invalide :\",refreshError.message);handleSessionExpired();return Promise.reject(refreshError);}}else handleSessionExpired();}/* =========================================================\r\n       ðŸš¨ ERREURS SERVEUR / RÃ‰SEAU\r\n       ========================================================= */if(!error.response){Swal.fire({icon:\"error\",title:\"Serveur injoignable\",text:\"Impossible de contacter le serveur. VÃ©rifiez votre connexion Internet.\",confirmButtonColor:\"#2563eb\"});console.error(\"âŒ Erreur rÃ©seau :\",error.message);return Promise.reject(error);}const alertOptions={confirmButtonColor:\"#2563eb\",text:message};switch(status){case 400:Swal.fire(_objectSpread({icon:\"warning\",title:\"RequÃªte invalide\"},alertOptions));break;case 403:Swal.fire(_objectSpread({icon:\"error\",title:\"AccÃ¨s refusÃ©\",text:\"Vous n'avez pas les droits nÃ©cessaires pour accÃ©der Ã  cette ressource.\"},alertOptions));break;case 404:Swal.fire(_objectSpread({icon:\"info\",title:\"Non trouvÃ©\"},alertOptions));break;case 500:default:Swal.fire(_objectSpread({icon:\"error\",title:\"Erreur serveur\",text:\"Le serveur a rencontrÃ© un problÃ¨me. RÃ©essayez plus tard.\"},alertOptions));break;}console.error(\"\\u274C Erreur API [\".concat(status,\"]:\"),message);return Promise.reject(error);});/* =========================================================\r\n   ðŸ§  GESTION AUTOMATIQUE DE SESSION EXPIRÃ‰E\r\n   ========================================================= */function handleSessionExpired(){Swal.fire({icon:\"warning\",title:\"Session expirÃ©e\",text:\"Votre session a expirÃ©. Veuillez vous reconnecter.\",confirmButtonColor:\"#2563eb\"}).then(()=>{localStorage.removeItem(\"token\");localStorage.removeItem(\"refreshToken\");localStorage.removeItem(\"user\");window.location.href=\"/admin-login\";});}export default api;","map":{"version":3,"names":["axios","Swal","API_BASE","_process$env$REACT_AP","process","env","REACT_APP_API_BASE_URL","replace","window","location","hostname","includes","console","log","api","create","baseURL","concat","headers","withCredentials","interceptors","request","use","config","token","localStorage","getItem","Authorization","error","Promise","reject","response","_error$response","_error$response2","_error$response2$data","originalRequest","status","message","data","_retry","refreshToken","post","newToken","setItem","refreshError","warn","handleSessionExpired","fire","icon","title","text","confirmButtonColor","alertOptions","_objectSpread","then","removeItem","href"],"sources":["C:/React/kocrou-transport -Deploy/client/src/utils/api.js"],"sourcesContent":["import axios from \"axios\";\r\nimport Swal from \"sweetalert2\";\r\n\r\n/* =========================================================\r\n   ðŸŒ BASE API URL â€” Gestion dynamique ENV (local + Vercel)\r\n   ========================================================= */\r\nconst API_BASE =\r\n  process.env.REACT_APP_API_BASE_URL?.replace(/\\/$/, \"\") ||\r\n  (window.location.hostname.includes(\"localhost\")\r\n    ? \"http://localhost:5000\"\r\n    : \"https://kocrou-transport-app-server.onrender.com\");\r\n\r\nconsole.log(\"ðŸ“¡ API_BASE =\", API_BASE);\r\n\r\n/* =========================================================\r\n   ðŸ§© INSTANCE AXIOS CENTRALISÃ‰E\r\n   ========================================================= */\r\nconst api = axios.create({\r\n  baseURL: `${API_BASE}/api`,\r\n  headers: { \"Content-Type\": \"application/json\" },\r\n  withCredentials: true, // âœ… autorise cookies CORS si nÃ©cessaires\r\n});\r\n\r\n/* =========================================================\r\n   ðŸ”’ INTERCEPTEUR DE REQUÃŠTES â€” Ajout Token\r\n   ========================================================= */\r\napi.interceptors.request.use(\r\n  (config) => {\r\n    const token = localStorage.getItem(\"token\");\r\n    if (token) config.headers.Authorization = `Bearer ${token}`;\r\n    return config;\r\n  },\r\n  (error) => Promise.reject(error)\r\n);\r\n\r\n/* =========================================================\r\n   âš ï¸ INTERCEPTEUR DE RÃ‰PONSES â€” Gestion Erreurs / Refresh\r\n   ========================================================= */\r\napi.interceptors.response.use(\r\n  (response) => response,\r\n  async (error) => {\r\n    const originalRequest = error.config;\r\n    const status = error.response?.status;\r\n    const message =\r\n      error.response?.data?.message ||\r\n      \"Une erreur est survenue lors de la communication avec le serveur.\";\r\n\r\n    // ðŸ” Tentative de refresh token\r\n    if (status === 401 && !originalRequest._retry) {\r\n      originalRequest._retry = true;\r\n\r\n      const refreshToken = localStorage.getItem(\"refreshToken\");\r\n      if (refreshToken) {\r\n        try {\r\n          const { data } = await axios.post(`${API_BASE}/api/auth/refresh`, {\r\n            refreshToken,\r\n          });\r\n\r\n          const newToken = data.token;\r\n          localStorage.setItem(\"token\", newToken);\r\n          originalRequest.headers[\"Authorization\"] = `Bearer ${newToken}`;\r\n\r\n          return api(originalRequest);\r\n        } catch (refreshError) {\r\n          console.warn(\"âš ï¸ Refresh token invalide :\", refreshError.message);\r\n          handleSessionExpired();\r\n          return Promise.reject(refreshError);\r\n        }\r\n      } else handleSessionExpired();\r\n    }\r\n\r\n    /* =========================================================\r\n       ðŸš¨ ERREURS SERVEUR / RÃ‰SEAU\r\n       ========================================================= */\r\n    if (!error.response) {\r\n      Swal.fire({\r\n        icon: \"error\",\r\n        title: \"Serveur injoignable\",\r\n        text: \"Impossible de contacter le serveur. VÃ©rifiez votre connexion Internet.\",\r\n        confirmButtonColor: \"#2563eb\",\r\n      });\r\n      console.error(\"âŒ Erreur rÃ©seau :\", error.message);\r\n      return Promise.reject(error);\r\n    }\r\n\r\n    const alertOptions = {\r\n      confirmButtonColor: \"#2563eb\",\r\n      text: message,\r\n    };\r\n\r\n    switch (status) {\r\n      case 400:\r\n        Swal.fire({ icon: \"warning\", title: \"RequÃªte invalide\", ...alertOptions });\r\n        break;\r\n      case 403:\r\n        Swal.fire({\r\n          icon: \"error\",\r\n          title: \"AccÃ¨s refusÃ©\",\r\n          text: \"Vous n'avez pas les droits nÃ©cessaires pour accÃ©der Ã  cette ressource.\",\r\n          ...alertOptions,\r\n        });\r\n        break;\r\n      case 404:\r\n        Swal.fire({ icon: \"info\", title: \"Non trouvÃ©\", ...alertOptions });\r\n        break;\r\n      case 500:\r\n      default:\r\n        Swal.fire({\r\n          icon: \"error\",\r\n          title: \"Erreur serveur\",\r\n          text: \"Le serveur a rencontrÃ© un problÃ¨me. RÃ©essayez plus tard.\",\r\n          ...alertOptions,\r\n        });\r\n        break;\r\n    }\r\n\r\n    console.error(`âŒ Erreur API [${status}]:`, message);\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n/* =========================================================\r\n   ðŸ§  GESTION AUTOMATIQUE DE SESSION EXPIRÃ‰E\r\n   ========================================================= */\r\nfunction handleSessionExpired() {\r\n  Swal.fire({\r\n    icon: \"warning\",\r\n    title: \"Session expirÃ©e\",\r\n    text: \"Votre session a expirÃ©. Veuillez vous reconnecter.\",\r\n    confirmButtonColor: \"#2563eb\",\r\n  }).then(() => {\r\n    localStorage.removeItem(\"token\");\r\n    localStorage.removeItem(\"refreshToken\");\r\n    localStorage.removeItem(\"user\");\r\n    window.location.href = \"/admin-login\";\r\n  });\r\n}\r\n\r\nexport default api;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}